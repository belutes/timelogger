<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:models="using:TimeLogger.App.Features.DataAnalysis.Models"
             xmlns:vm="using:TimeLogger.App.Features.DataAnalysis.ViewModels"
             mc:Ignorable="d"
             x:Class="TimeLogger.App.Features.DataAnalysis.Views.DataAnalysisView"
             x:DataType="vm:DataAnalysisViewModel"
             d:DesignWidth="1100"
             d:DesignHeight="700">

  <UserControl.Styles>
    <Style Selector="Button.mode-btn">
      <Setter Property="Background" Value="#5A5A5A" />
      <Setter Property="BorderBrush" Value="#5A5A5A" />
      <Setter Property="Foreground" Value="#ECECEC" />
      <Setter Property="Padding" Value="10,4" />
      <Setter Property="CornerRadius" Value="6" />
      <Setter Property="FontWeight" Value="SemiBold" />
    </Style>

    <Style Selector="Button.mode-btn.selected-mode">
      <Setter Property="Background" Value="#3B82F6" />
      <Setter Property="BorderBrush" Value="#3B82F6" />
      <Setter Property="Foreground" Value="White" />
    </Style>

    <Style Selector="ProgressBar.analysis-bar">
      <Setter Property="Height" Value="18" />
      <Setter Property="Maximum" Value="100" />
      <Setter Property="Foreground" Value="#3B82F6" />
      <Setter Property="Background" Value="#8A8A8A" />
    </Style>
  </UserControl.Styles>

  <Grid Margin="16,10,16,8" ColumnDefinitions="1*,1.15*" ColumnSpacing="18">
      <Border Grid.Column="0"
              Background="#343434"
              CornerRadius="10"
              Padding="12"
              VerticalAlignment="Stretch">
        <Grid RowDefinitions="Auto,Auto,Auto,*" RowSpacing="10">
          <TextBlock Text="{Binding DayTitle}"
                     FontSize="20"
                     FontWeight="SemiBold"
                     HorizontalAlignment="Center" />

          <Grid Grid.Row="1" ColumnDefinitions="180,*" ColumnSpacing="12">
            <StackPanel Spacing="6" Margin="0,10,0,0">
              <TextBlock Text="Legend" FontWeight="SemiBold" />
              <ItemsControl ItemsSource="{Binding DayBreakdown}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate x:DataType="models:ActivityBreakdownItem">
                    <Grid ColumnDefinitions="12,*" ColumnSpacing="8" Margin="0,0,0,6" Width="160">
                      <Border Width="12" Height="12" Background="{Binding ColorHex}" Margin="0,3,0,0" />
                      <TextBlock Grid.Column="1" Text="{Binding LegendText}" TextWrapping="Wrap" />
                    </Grid>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </StackPanel>

            <Grid Grid.Column="1" Width="230" Height="230" HorizontalAlignment="Right" VerticalAlignment="Center">
              <Grid Width="210" Height="210" HorizontalAlignment="Center" VerticalAlignment="Center">
                <ItemsControl Width="210" Height="210" ItemsSource="{Binding PieSlices}">
                  <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                      <Canvas />
                    </ItemsPanelTemplate>
                  </ItemsControl.ItemsPanel>
                  <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="models:PieSliceItem">
                      <Path Data="{Binding PathData}" Fill="{Binding ColorHex}" />
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>

                <Ellipse Width="210" Height="210" Stroke="#E7E7E7" StrokeThickness="1" Fill="Transparent" />
              </Grid>
            </Grid>
          </Grid>

          <Border Grid.Row="2" Height="1" Background="#E2E2E2" Margin="0,0,0,2" />

          <StackPanel Grid.Row="3" Spacing="8">
            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
              <TextBlock Text="Bar:" FontWeight="SemiBold" VerticalAlignment="Center" />
              <Button Content="Weekly"
                      Command="{Binding SelectWeeklyCommand}"
                      Classes="mode-btn"
                      Classes.selected-mode="{Binding IsWeeklySelected}" />
              <Button Content="Monthly"
                      Command="{Binding SelectMonthlyCommand}"
                      Classes="mode-btn"
                      Classes.selected-mode="{Binding IsMonthlySelected}" />
            </StackPanel>

            <TextBlock Text="{Binding BarHeading}" FontWeight="SemiBold" FontSize="17" />

            <ItemsControl ItemsSource="{Binding BarItems}">
              <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="models:ActivityBreakdownItem">
                  <Grid ColumnDefinitions="110,*,Auto" ColumnSpacing="8" Margin="0,0,0,12">
                    <TextBlock Text="{Binding Name}" Opacity="0.9" VerticalAlignment="Center" />
                    <ProgressBar Grid.Column="1" Classes="analysis-bar" Value="{Binding Percentage}" />
                    <TextBlock Grid.Column="2" Text="{Binding PercentText}" FontWeight="SemiBold" VerticalAlignment="Center" />
                  </Grid>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </StackPanel>
        </Grid>
      </Border>

      <Border Grid.Column="1"
              Background="#343434"
              CornerRadius="10"
              Padding="12"
              VerticalAlignment="Stretch">
        <Grid RowDefinitions="Auto,Auto,*,Auto" RowSpacing="10">
          <Grid ColumnDefinitions="Auto,Auto" ColumnSpacing="10">
            <TextBlock Text="Details" FontSize="20" FontWeight="SemiBold" VerticalAlignment="Center" />
            <ComboBox Grid.Column="1"
                      Width="130"
                      ItemsSource="{Binding DetailRangeOptions}"
                      SelectedItem="{Binding SelectedDetailRange}" />
          </Grid>

          <TextBlock Grid.Row="1"
                     Text="{Binding DetailHeading}"
                     FontStyle="Italic"
                     FontSize="17"
                     Opacity="0.95" />

          <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding DetailItems}">
              <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="models:ActivityBreakdownItem">
                  <Border Background="#3C3C3C" CornerRadius="7" Padding="10" Margin="0,0,0,8">
                    <Grid ColumnDefinitions="*,Auto">
                      <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="17" />
                      <TextBlock Grid.Column="1" Text="{Binding DurationText}" FontWeight="SemiBold" FontSize="17" />
                    </Grid>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </ScrollViewer>

          <Border Grid.Row="3" Background="#3C3C3C" CornerRadius="7" Padding="10">
            <Grid ColumnDefinitions="*,Auto">
              <TextBlock Text="Total" FontWeight="SemiBold" FontSize="17" />
              <TextBlock Grid.Column="1" Text="{Binding TotalDurationText}" FontWeight="SemiBold" FontSize="17" />
            </Grid>
          </Border>
        </Grid>
      </Border>
    </Grid>
</UserControl>
